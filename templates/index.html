{% extends "base.html" %}

{% block content %}
<div id="content-wrapper">
	<div id="sidebar">
    <h3>Data Fields</h3>
    <div class="accordion" id="statements_accordion">
      {% for statement in statements %}
        <div class="accordion-group" id="{{statement.slug}}_group">
          <div class="according-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#statements_accordion" href="#{{statement.slug}}_body">
              {{statement.name}}
            </a>
          </div>
          <div class="accordion-body collapse" id="{{statement.slug}}_body">
            <table class="table-striped table-condensed">
              <tbody>
                {% for field in statement.fields %}
                  <tr>
                    <td>{{ field }}</td>
                    <td>
                      <a class="chartChanger" href="#" id="xAxis_{{loop.index + statement.offset}}">  X
                      </a>
                    </td>
                    <td>
                      <a href="#" class="chartChanger" id="yAxis_{{loop.index + statement.offset}}">
                      Y
                      </a>
                    </td>
                    <td>
                      <a href="#" class="chartChanger" id="size_{{loop.index + statement.offset}}">
                        Size
                      </a>
                    </td>
                    <td>
                      <a href="#" class="chartChanger" id="color_{{loop.index + statement.offset}}">
                        Color
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% endfor %}
    </div>
		<hr>
    <h3>Companies</h3>
    <div class="accordion" id="divisions_accordion">
      {% for division in divisions %}
        <div class="accordion-group" id="{{division.id}}_group">
          <div class="according-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#divisions_accordion" href="#{{division.id}}_body">
              {{division.name}}
            </a>
          </div>
          <div class="accordion-body collapse" id="{{division.id}}_body">
            <div class="accordion minor" id="{{division.id}}_accordion">
              {% for major_group in division.major_groups %}
                <div class="accordion-group" id="{{major_group.id}}_group">
                  <div class="according-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#{{division.id}}_accordion" href="#{{major_group.id}}_body">
                      {{major_group.name}}
                    </a>
                    <a href="#"><i class="icon-share-alt"></i></a>
                  </div>
                  <div class="accordion-body collapse" id="{{major_group.id}}_body">
                    <table class="table-striped table-condensed">
                      <tbody>
                        {% for industry_group in major_group.industry_groups %}
                          <tr>
                            <td>
                              <a href="#">{{industry_group.name}}</a>
                            </td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <hr>
   	<footer>
      <p>&copy; Zach, Josh, Pulak, and Alex 2012</p>
    </footer>
	</div>
	<div id="graph-wrapper">
		<div id="chart_div" style="height:100%;">
      <center><h1><small>Loading...</small></h1></small>
    </div>
	</div>
</div>
{% endblock content %}

{% block scripts %}
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
var app = {};
google.load('visualization', '1', {'packages':['motionchart']});
google.setOnLoadCallback(drawChart);
function drawChart() {
  $.get('/api/example/', function(data){
    console.log(data)
    app.datatable = new google.visualization.DataTable(data, 1);
    console.log(app.datatable);
    app.options = {
      height:$('#chart_div').height(), 
      width:$('#chart_div').width(),
      // showXMetricPicker:false,
      // showYMetricPicker:false,
    };
    app.chart = new google.visualization.MotionChart(document.getElementById('chart_div'));
    app.chart.draw(app.datatable, app.options);
  });
  
}

$(function(){
  $('.chartChanger').click(function(){
    var index = $(this).attr('id').split('_')[1];
    var axis = $(this).attr('id').split('_')[0];
    var state = app.chart.getState();
    state = $.parseJSON(state);
    state[axis+'Option'] = index.toString();
    // console.log(state)
    state = JSON.stringify(state);
    // console.log(state);
    app.options.state = state;
    app.chart.draw(app.datatable, app.options);
  })
});


function redrawChart() {
  app.options = app.options || {};
  app.options.height = $('#chart_div').height();
  app.options.width = $('#chart_div').width();
  app.chart.draw(app.datatable, app.options);
}

window.onresize = redrawChart;
</script>
{% endblock scripts %}